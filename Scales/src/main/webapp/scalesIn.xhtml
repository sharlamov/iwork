THIS.WRAPPER).SETSTYLE("MARGIN",0);THIS.NOW=[];THIS.OPEN=!0},VERTICAL:FUNCTION(){THIS.MARGIN="MARGIN-TOP";THIS.LAYOUT="HEIGHT";THIS.OFFSET=THIS.ELEMENT.OFFSETHEIGHT},HORIZONTAL:FUNCTION(){THIS.MARGIN="MARGIN-LEFT";THIS.LAYOUT="WIDTH";THIS.OFFSET=THIS.ELEMENT.OFFSETWIDTH},SET:FUNCTION(A){THIS.ELEMENT.SETSTYLE(THIS.MARGIN,A[0]);THIS.WRAPPER.SETSTYLE(THIS.LAYOUT,A[1]);RETURN THIS},COMPUTE:FUNCTION(A,B,C){VAR D=[];(2).TIMES(FUNCTION(E){D[E]=FX.COMPUTE(A[E],B[E],C)});RETURN D},START:FUNCTION(A,B){IF(!THIS.CHECK(ARGUMENTS.CALLEE,
A,B))RETURN THIS;THIS[B||THIS.OPTIONS.MODE]();VAR C=THIS.ELEMENT.GETSTYLE(THIS.MARGIN).TOINT(),D=THIS.WRAPPER.GETSTYLE(THIS.LAYOUT).TOINT(),E=[[C,D],[0,THIS.OFFSET]],C=[[C,D],[-THIS.OFFSET,0]],F;SWITCH(A){CASE "IN":F=E;BREAK;CASE "OUT":F=C;BREAK;CASE "TOGGLE":F=THIS.WRAPPER["OFFSET"+THIS.LAYOUT.CAPITALIZE()]==0?E:C}RETURN THIS.PARENT(F[0],F[1])},SLIDEIN:FUNCTION(A){RETURN THIS.START("IN",A)},SLIDEOUT:FUNCTION(A){RETURN THIS.START("OUT",A)},HIDE:FUNCTION(A){THIS[A||THIS.OPTIONS.MODE]();THIS.OPEN=!1;
RETURN THIS.SET([-THIS.OFFSET,0])},SHOW:FUNCTION(A){THIS[A||THIS.OPTIONS.MODE]();THIS.OPEN=!0;RETURN THIS.SET([0,THIS.OFFSET])},TOGGLE:FUNCTION(A){RETURN THIS.START("TOGGLE",A)}});
ELEMENT.PROPERTIES.SLIDE={SET:FUNCTION(A){VAR B=THIS.RETRIEVE("SLIDE");B&&B.CANCEL();RETURN THIS.ELIMINATE("SLIDE").STORE("SLIDE:OPTIONS",$EXTEND({LINK:"CANCEL"},A))},GET:FUNCTION(A){IF(A||!THIS.RETRIEVE("SLIDE"))(A||!THIS.RETRIEVE("SLIDE:OPTIONS"))&&THIS.SET("SLIDE",A),THIS.STORE("SLIDE",NEW FX.SLIDE(THIS,THIS.RETRIEVE("SLIDE:OPTIONS")));RETURN THIS.RETRIEVE("SLIDE")}};
ELEMENT.IMPLEMENT({SLIDE:FUNCTION(A,B){VAR A=A||"TOGGLE",C=THIS.GET("SLIDE"),D;SWITCH(A){CASE "HIDE":C.HIDE(B);BREAK;CASE "SHOW":C.SHOW(B);BREAK;CASE "TOGGLE":D=THIS.RETRIEVE("SLIDE:FLAG",C.OPEN);C[D?"SLIDEOUT":"SLIDEIN"](B);THIS.STORE("SLIDE:FLAG",!D);D=!0;BREAK;DEFAULT:C.START(A,B)}D||THIS.ELIMINATE("SLIDE:FLAG");RETURN THIS}});
FX.SCROLL=NEW CLASS({EXTENDS:FX,OPTIONS:{OFFSET:{X:0,Y:0},WHEELSTOPS:!0},INITIALIZE:FUNCTION(A,B){THIS.ELEMENT=THIS.SUBJECT=$(A);THIS.PARENT(B);VAR C=THIS.CANCEL.BIND(THIS,!1);IF($TYPE(THIS.ELEMENT)!="ELEMENT")THIS.ELEMENT=$(THIS.ELEMENT.GETDOCUMENT().BODY);VAR D=THIS.ELEMENT;THIS.OPTIONS.WHEELSTOPS&&(THIS.ADDEVENT("START",FUNCTION(){D.ADDEVENT("MOUSEWHEEL",C)},!0),THIS.ADDEVENT("COMPLETE",FUNCTION(){D.REMOVEEVENT("MOUSEWHEEL",C)},!0))},SET:FUNCTION(){VAR A=ARRAY.FLATTEN(ARGUMENTS);THIS.ELEMENT.SCROLLTO(A[0],
A[1])},COMPUTE:FUNCTION(A,B,C){VAR D=[];(2).TIMES(FUNCTION(E){D.PUSH(FX.COMPUTE(A[E],B[E],C))});RETURN D},START:FUNCTION(A,B){IF(!THIS.CHECK(ARGUMENTS.CALLEE,A,B))RETURN THIS;VAR C=THIS.ELEMENT.GETSIZE(),D=THIS.ELEMENT.GETSCROLLSIZE(),E=THIS.ELEMENT.GETSCROLL(),F={X:A,Y:B},G;FOR(G IN F){VAR H=D[G]-C[G];F[G]=$CHK(F[G])?$TYPE(F[G])=="NUMBER"?F[G].LIMIT(0,H):H:E[G];F[G]+=THIS.OPTIONS.OFFSET[G]}RETURN THIS.PARENT([E.X,E.Y],[F.X,F.Y])},TOTOP:FUNCTION(){RETURN THIS.START(!1,0)},TOLEFT:FUNCTION(){RETURN THIS.START(0,
!1)},TORIGHT:FUNCTION(){RETURN THIS.START("RIGHT",!1)},TOBOTTOM:FUNCTION(){RETURN THIS.START(!1,"BOTTOM")},TOELEMENT:FUNCTION(A){A=$(A).GETPOSITION(THIS.ELEMENT);RETURN THIS.START(A.X,A.Y)}});
FX.ELEMENTS=NEW CLASS({EXTENDS:FX.CSS,INITIALIZE:FUNCTION(A,B){THIS.ELEMENTS=THIS.SUBJECT=$$(A);THIS.PARENT(B)},COMPUTE:FUNCTION(A,B,C){VAR D={},E;FOR(E IN A){VAR F=A[E],G=B[E],H=D[E]={},I;FOR(I IN F)H[I]=THIS.PARENT(F[I],G[I],C)}RETURN D},SET:FUNCTION(A){FOR(VAR B IN A){VAR C=A[B],D;FOR(D IN C)THIS.RENDER(THIS.ELEMENTS[B],D,C[D],THIS.OPTIONS.UNIT)}RETURN THIS},START:FUNCTION(A){IF(!THIS.CHECK(ARGUMENTS.CALLEE,A))RETURN THIS;VAR B={},C={},D;FOR(D IN A){VAR E=A[D],F=B[D]={},G=C[D]={},H;FOR(H IN E){VAR I=
THIS.PREPARE(THIS.ELEMENTS[D],H,E[H]);F[H]=I.FROM;G[H]=I.TO}}RETURN THIS.PARENT(B,C)}});
VAR DRAG=NEW CLASS({IMPLEMENTS:[EVENTS,OPTIONS],OPTIONS:{SNAP:6,UNIT:"PX",GRID:!1,STYLE:!0,LIMIT:!1,HANDLE:!1,INVERT:!1,PREVENTDEFAULT:!1,MODIFIERS:{X:"LEFT",Y:"TOP"}},INITIALIZE:FUNCTION(){VAR A=ARRAY.LINK(ARGUMENTS,{OPTIONS:OBJECT.TYPE,ELEMENT:$DEFINED});THIS.ELEMENT=$(A.ELEMENT);THIS.DOCUMENT=THIS.ELEMENT.GETDOCUMENT();THIS.SETOPTIONS(A.OPTIONS||{});A=$TYPE(THIS.OPTIONS.HANDLE);THIS.HANDLES=A=="ARRAY"||A=="COLLECTION"?$$(THIS.OPTIONS.HANDLE):$(THIS.OPTIONS.HANDLE)||THIS.ELEMENT;THIS.MOUSE={NOW:{},
POS:{}};THIS.VALUE={START:{},NOW:{}};THIS.SELECTION=BROWSER.ENGINE.TRIDENT?"SELECTSTART":"MOUSEDOWN";THIS.BOUND={START:THIS.START.BIND(THIS),CHECK:THIS.CHECK.BIND(THIS),DRAG:THIS.DRAG.BIND(THIS),STOP:THIS.STOP.BIND(THIS),CANCEL:THIS.CANCEL.BIND(THIS),EVENTSTOP:$LAMBDA(!1)};THIS.ATTACH()},ATTACH:FUNCTION(){THIS.HANDLES.ADDEVENT("MOUSEDOWN",THIS.BOUND.START);RETURN THIS},DETACH:FUNCTION(){THIS.HANDLES.REMOVEEVENT("MOUSEDOWN",THIS.BOUND.START);RETURN THIS},START:FUNCTION(A){THIS.OPTIONS.PREVENTDEFAULT&&
A.PREVENTDEFAULT();THIS.FIREEVENT("BEFORESTART",THIS.ELEMENT);THIS.MOUSE.START=A.PAGE;VAR B=THIS.OPTIONS.LIMIT;THIS.LIMIT={X:[],Y:[]};FOR(VAR C IN THIS.OPTIONS.MODIFIERS)IF(THIS.OPTIONS.MODIFIERS[C]&&(THIS.VALUE.NOW[C]=THIS.OPTIONS.STYLE?THIS.ELEMENT.GETSTYLE(THIS.OPTIONS.MODIFIERS[C]).TOINT():THIS.ELEMENT[THIS.OPTIONS.MODIFIERS[C]],THIS.OPTIONS.INVERT&&(THIS.VALUE.NOW[C]*=-1),THIS.MOUSE.POS[C]=A.PAGE[C]-THIS.VALUE.NOW[C],B&&B[C]))FOR(VAR D=2;D--;)$CHK(B[C][D])&&(THIS.LIMIT[C][D]=$LAMBDA(B[C][D])());
IF($TYPE(THIS.OPTIONS.GRID)=="NUMBER")THIS.OPTIONS.GRID={X:THIS.OPTIONS.GRID,Y:THIS.OPTIONS.GRID};THIS.DOCUMENT.ADDEVENTS({MOUSEMOVE:THIS.BOUND.CHECK,MOUSEUP:THIS.BOUND.CANCEL});THIS.DOCUMENT.ADDEVENT(THIS.SELECTION,THIS.BOUND.EVENTSTOP)},CHECK:FUNCTION(A){THIS.OPTIONS.PREVENTDEFAULT&&A.PREVENTDEFAULT();MATH.ROUND(MATH.SQRT(MATH.POW(A.PAGE.X-THIS.MOUSE.START.X,2)+MATH.POW(A.PAGE.Y-THIS.MOUSE.START.Y,2)))>THIS.OPTIONS.SNAP&&(THIS.CANCEL(),THIS.DOCUMENT.ADDEVENTS({MOUSEMOVE:THIS.BOUND.DRAG,MOUSEUP:THIS.BOUND.STOP}),
THIS.FIREEVENT("START",THIS.ELEMENT).FIREEVENT("SNAP",THIS.ELEMENT))},DRAG:FUNCTION(A){THIS.OPTIONS.PREVENTDEFAULT&&A.PREVENTDEFAULT();THIS.MOUSE.NOW=A.PAGE;FOR(VAR B IN THIS.OPTIONS.MODIFIERS)THIS.OPTIONS.MODIFIERS[B]&&(THIS.VALUE.NOW[B]=THIS.MOUSE.NOW[B]-THIS.MOUSE.POS[B],THIS.OPTIONS.INVERT&&(THIS.VALUE.NOW[B]*=-1),THIS.OPTIONS.LIMIT&&THIS.LIMIT[B]&&($CHK(THIS.LIMIT[B][1])&&THIS.VALUE.NOW[B]>THIS.LIMIT[B][1]?THIS.VALUE.NOW[B]=THIS.LIMIT[B][1]:$CHK(THIS.LIMIT[B][0])&&THIS.VALUE.NOW[B]<THIS.LIMIT[B][0]&&
(THIS.VALUE.NOW[B]=THIS.LIMIT[B][0])),THIS.OPTIONS.GRID[B]&&(THIS.VALUE.NOW[B]-=THIS.VALUE.NOW[B]%THIS.OPTIONS.GRID[B]),THIS.OPTIONS.STYLE?THIS.ELEMENT.SETSTYLE(THIS.OPTIONS.MODIFIERS[B],THIS.VALUE.NOW[B]+THIS.OPTIONS.UNIT):THIS.ELEMENT[THIS.OPTIONS.MODIFIERS[B]]=THIS.VALUE.NOW[B]);THIS.FIREEVENT("DRAG",THIS.ELEMENT)},CANCEL:FUNCTION(A){THIS.DOCUMENT.REMOVEEVENT("MOUSEMOVE",THIS.BOUND.CHECK);THIS.DOCUMENT.REMOVEEVENT("MOUSEUP",THIS.BOUND.CANCEL);A&&(THIS.DOCUMENT.REMOVEEVENT(THIS.SELECTION,THIS.BOUND.EVENTSTOP),
THIS.FIREEVENT("CANCEL",THIS.ELEMENT))},STOP:FUNCTION(A){THIS.BOUND.DRAG(A);THIS.DOCUMENT.REMOVEEVENT(THIS.SELECTION,THIS.BOUND.EVENTSTOP);THIS.DOCUMENT.REMOVEEVENT("MOUSEMOVE",THIS.BOUND.DRAG);THIS.DOCUMENT.REMOVEEVENT("MOUSEUP",THIS.BOUND.STOP);A&&THIS.FIREEVENT("COMPLETE",THIS.ELEMENT)}});ELEMENT.IMPLEMENT({MAKERESIZABLE:FUNCTION(A){RETURN NEW DRAG(THIS,$MERGE({MODIFIERS:{X:"WIDTH",Y:"HEIGHT"}},A))}});
DRAG.MOVE=NEW CLASS({EXTENDS:DRAG,OPTIONS:{DROPPABLES:[],CONTAINER:!1},INITIALIZE:FUNCTION(A,B){THIS.PARENT(A,B);THIS.DROPPABLES=$$(THIS.OPTIONS.DROPPABLES);IF((THIS.CONTAINER=$(THIS.OPTIONS.CONTAINER))&&$TYPE(THIS.CONTAINER)!="ELEMENT")THIS.CONTAINER=$(THIS.CONTAINER.GETDOCUMENT().BODY);VAR A=THIS.ELEMENT,C=A.GETSTYLE("POSITION"),C=C!="STATIC"?C:"ABSOLUTE";(A.GETSTYLE("LEFT")=="AUTO"||A.GETSTYLE("TOP")=="AUTO")&&A.POSITION(A.GETPOSITION(A.OFFSETPARENT));A.SETSTYLE("POSITION",C);THIS.ADDEVENT("START",
FUNCTION(){THIS.CHECKDROPPABLES()},!0)},START:FUNCTION(A){IF(THIS.CONTAINER){VAR B=THIS.ELEMENT,C=THIS.CONTAINER,D=C.GETCOORDINATES(B.OFFSETPARENT),E={},F={};["TOP","RIGHT","BOTTOM","LEFT"].EACH(FUNCTION(A){E[A]=C.GETSTYLE("PADDING-"+A).TOINT();F[A]=B.GETSTYLE("MARGIN-"+A).TOINT()},THIS);THIS.OPTIONS.LIMIT={X:[D.LEFT+E.LEFT,D.RIGHT-E.RIGHT-(B.OFFSETWIDTH+F.LEFT+F.RIGHT)],Y:[D.TOP+E.TOP,D.BOTTOM-E.BOTTOM-(B.OFFSETHEIGHT+F.TOP+F.BOTTOM)]}}THIS.PARENT(A)},CHECKAGAINST:FUNCTION(A){VAR A=A.GETCOORDINATES(),
B=THIS.MOUSE.NOW;RETURN B.X>A.LEFT&&B.X<A.RIGHT&&B.Y<A.BOTTOM&&B.Y>A.TOP},CHECKDROPPABLES:FUNCTION(){VAR A=THIS.DROPPABLES.FILTER(THIS.CHECKAGAINST,THIS).GETLAST();IF(THIS.OVERED!=A)THIS.OVERED&&THIS.FIREEVENT("LEAVE",[THIS.ELEMENT,THIS.OVERED]),A?(THIS.OVERED=A,THIS.FIREEVENT("ENTER",[THIS.ELEMENT,A])):THIS.OVERED=NULL},DRAG:FUNCTION(A){THIS.PARENT(A);THIS.DROPPABLES.LENGTH&&THIS.CHECKDROPPABLES()},STOP:FUNCTION(A){THIS.CHECKDROPPABLES();THIS.FIREEVENT("DROP",[THIS.ELEMENT,THIS.OVERED]);THIS.OVERED=
NULL;RETURN THIS.PARENT(A)}});ELEMENT.IMPLEMENT({MAKEDRAGGABLE:FUNCTION(A){RETURN NEW DRAG.MOVE(THIS,A)}});HASH.COOKIE=NEW CLASS({EXTENDS:COOKIE,OPTIONS:{AUTOSAVE:!0},INITIALIZE:FUNCTION(A,B){THIS.PARENT(A,B);THIS.LOAD()},SAVE:FUNCTION(){VAR A=JSON.ENCODE(THIS.HASH);IF(!A||A.LENGTH>4096)RETURN!1;A=="{}"?THIS.DISPOSE():THIS.WRITE(A);RETURN!0},LOAD:FUNCTION(){THIS.HASH=NEW HASH(JSON.DECODE(THIS.READ(),!0));RETURN THIS}});
HASH.COOKIE.IMPLEMENT(FUNCTION(){VAR A={};HASH.EACH(HASH.PROTOTYPE,FUNCTION(B,C){A[C]=FUNCTION(){VAR A=B.APPLY(THIS.HASH,ARGUMENTS);THIS.OPTIONS.AUTOSAVE&&THIS.SAVE();RETURN A}});RETURN A}());
VAR COLOR=NEW NATIVE({INITIALIZE:FUNCTION(A,B){ARGUMENTS.LENGTH>=3?(B="RGB",A=ARRAY.SLICE(ARGUMENTS,0,3)):TYPEOF A=="STRING"&&(A=A.MATCH(/RGB/)?A.RGBTOHEX().HEXTORGB(!0):A.MATCH(/HSB/)?A.HSBTORGB():A.HEXTORGB(!0));SWITCH(B||"RGB"){CASE "HSB":VAR C=A,A=A.HSBTORGB();A.HSB=C;BREAK;CASE "HEX":A=A.HEXTORGB(!0)}A.RGB=A.SLICE(0,3);A.HSB=A.HSB||A.RGBTOHSB();A.HEX=A.RGBTOHEX();RETURN $EXTEND(A,THIS)}});
COLOR.IMPLEMENT({MIX:FUNCTION(){VAR A=ARRAY.SLICE(ARGUMENTS),B=$TYPE(A.GETLAST())=="NUMBER"?A.POP():50,C=THIS.SLICE();A.EACH(FUNCTION(A){FOR(VAR A=NEW COLOR(A),E=0;E<3;E++)C[E]=MATH.ROUND(C[E]/100*(100-B)+A[E]/100*B)});RETURN NEW COLOR(C,"RGB")},INVERT:FUNCTION(){RETURN NEW COLOR(THIS.MAP(FUNCTION(A){RETURN 255-A}))},SETHUE:FUNCTION(A){RETURN NEW COLOR([A,THIS.HSB[1],THIS.HSB[2]],"HSB")},SETSATURATION:FUNCTION(A){RETURN NEW COLOR([THIS.HSB[0],A,THIS.HSB[2]],"HSB")},SETBRIGHTNESS:FUNCTION(A){RETURN NEW COLOR([THIS.HSB[0],
THIS.HSB[1],A],"HSB")}});FUNCTION $RGB(A,B,C){RETURN NEW COLOR([A,B,C],"RGB")}FUNCTION $HSB(A,B,C){RETURN NEW COLOR([A,B,C],"HSB")}FUNCTION $HEX(A){RETURN NEW COLOR(A,"HEX")}
ARRAY.IMPLEMENT({RGBTOHSB:FUNCTION(){VAR A=THIS[0],B=THIS[1],C=THIS[2],D,E=MATH.MAX(A,B,C),F=E-MATH.MIN(A,B,C);D=E!=0?F/E:0;IF(D==0)A=0;ELSE{VAR G=(E-A)/F,H=(E-B)/F,C=(E-C)/F,A=A==E?C-H:B==E?2+G-C:4+H-G;A/=6;A<0&&A++}RETURN[MATH.ROUND(A*360),MATH.ROUND(D*100),MATH.ROUND(E/255*100)]},HSBTORGB:FUNCTION(){VAR A=MATH.ROUND(THIS[2]/100*255);IF(THIS[1]==0)RETURN[A,A,A];ELSE{VAR B=THIS[0]%360,C=B%60,D=MATH.ROUND(THIS[2]*(100-THIS[1])/1E4*255),E=MATH.ROUND(THIS[2]*(6E3-THIS[1]*C)/6E5*255),C=MATH.ROUND(THIS[2]*
(6E3-THIS[1]*(60-C))/6E5*255);SWITCH(MATH.FLOOR(B/60)){CASE 0:RETURN[A,C,D];CASE 1:RETURN[E,A,D];CASE 2:RETURN[D,A,C];CASE 3:RETURN[D,E,A];CASE 4:RETURN[C,D,A];CASE 5:RETURN[A,D,E]}}RETURN!1}});STRING.IMPLEMENT({RGBTOHSB:FUNCTION(){RETURN THIS.MATCH(/\D{1,3}/G)?HSB.RGBTOHSB():NULL},HSBTORGB:FUNCTION(){VAR A=THIS.MATCH(/\D{1,3}/G);RETURN A?A.HSBTORGB():NULL}});
VAR GROUP=NEW CLASS({INITIALIZE:FUNCTION(){THIS.INSTANCES=ARRAY.FLATTEN(ARGUMENTS);THIS.EVENTS={};THIS.CHECKER={}},ADDEVENT:FUNCTION(A,B){THIS.CHECKER[A]=THIS.CHECKER[A]||{};THIS.EVENTS[A]=THIS.EVENTS[A]||[];IF(THIS.EVENTS[A].CONTAINS(B))RETURN!1;ELSE THIS.EVENTS[A].PUSH(B);THIS.INSTANCES.EACH(FUNCTION(B,D){B.ADDEVENT(A,THIS.CHECK.BIND(THIS,[A,B,D]))},THIS);RETURN THIS},CHECK:FUNCTION(A,B,C){THIS.CHECKER[A][C]=!0;THIS.INSTANCES.EVERY(FUNCTION(B,C){RETURN THIS.CHECKER[A][C]||!1},THIS)&&(THIS.CHECKER[A]=
{},THIS.EVENTS[A].EACH(FUNCTION(A){A.CALL(THIS,THIS.INSTANCES,B)},THIS))}}),ASSET=NEW HASH({JAVASCRIPT:FUNCTION(A,B){VAR B=$EXTEND({ONLOAD:$EMPTY,DOCUMENT:DOCUMENT,CHECK:$LAMBDA(!0)},B),C=NEW ELEMENT("SCRIPT",{SRC:A,TYPE:"TEXT/JAVASCRIPT"}),D=B.ONLOAD.BIND(C),E=B.CHECK,F=B.DOCUMENT;DELETE B.ONLOAD;DELETE B.CHECK;DELETE B.DOCUMENT;C.ADDEVENTS({LOAD:D,READYSTATECHANGE:FUNCTION(){["LOADED","COMPLETE"].CONTAINS(THIS.READYSTATE)&&D()}}).SETPROPERTIES(B);IF(BROWSER.ENGINE.WEBKIT419)VAR G=FUNCTION(){$TRY(E)&&
($CLEAR(G),D())}.PERIODICAL(50);RETURN C.INJECT(F.HEAD)},CSS:FUNCTION(A,B){RETURN(NEW ELEMENT("LINK",$MERGE({REL:"STYLESHEET",MEDIA:"SCREEN",TYPE:"TEXT/CSS",HREF:A},B))).INJECT(DOCUMENT.HEAD)},IMAGE:FUNCTION(A,B){VAR B=$MERGE({ONLOAD:$EMPTY,ONABORT:$EMPTY,ONERROR:$EMPTY},B),C=NEW IMAGE,D=$(C)||NEW ELEMENT("IMG");["LOAD","ABORT","ERROR"].EACH(FUNCTION(A){VAR F="ON"+A,G=B[F];DELETE B[F];C[F]=FUNCTION(){VAR E;IF(C){IF(!D.PARENTNODE)D.WIDTH=C.WIDTH,D.HEIGHT=C.HEIGHT;E=C.ONLOAD=C.ONABORT=C.ONERROR=NULL,
C=E;G.DELAY(1,D,D);D.FIREEVENT(A,D,1)}}});C.SRC=D.SRC=A;C&&C.COMPLETE&&C.ONLOAD.DELAY(1);RETURN D.SETPROPERTIES(B)},IMAGES:FUNCTION(A,B){B=$MERGE({ONCOMPLETE:$EMPTY,ONPROGRESS:$EMPTY},B);A.PUSH||(A=[A]);VAR C=[],D=0;A.EACH(FUNCTION(E){VAR F=NEW ASSET.IMAGE(E,{ONLOAD:FUNCTION(){B.ONPROGRESS.CALL(THIS,D,A.INDEXOF(E));D++;IF(D==A.LENGTH)B.ONCOMPLETE()}});C.PUSH(F)});RETURN NEW ELEMENTS(C)}}),SORTABLES=NEW CLASS({IMPLEMENTS:[EVENTS,OPTIONS],OPTIONS:{SNAP:4,OPACITY:1,CLONE:!1,REVERT:!1,HANDLE:!1,CONSTRAIN:!1},
INITIALIZE:FUNCTION(A,B){THIS.SETOPTIONS(B);THIS.ELEMENTS=[];THIS.LISTS=[];THIS.IDLE=!0;THIS.ADDLISTS($$($(A)||A));IF(!THIS.OPTIONS.CLONE)THIS.OPTIONS.REVERT=!1;IF(THIS.OPTIONS.REVERT)THIS.EFFECT=NEW FX.MORPH(NULL,$MERGE({DURATION:250,LINK:"CANCEL"},THIS.OPTIONS.REVERT))},ATTACH:FUNCTION(){THIS.ADDLISTS(THIS.LISTS);RETURN THIS},DETACH:FUNCTION(){THIS.LISTS=THIS.REMOVELISTS(THIS.LISTS);RETURN THIS},ADDITEMS:FUNCTION(){ARRAY.FLATTEN(ARGUMENTS).EACH(FUNCTION(A){THIS.ELEMENTS.PUSH(A);VAR B=A.RETRIEVE("SORTABLES:START",
THIS.START.BINDWITHEVENT(THIS,A));(THIS.OPTIONS.HANDLE?A.GETELEMENT(THIS.OPTIONS.HANDLE)||A:A).ADDEVENT("MOUSEDOWN",B)},THIS);RETURN THIS},ADDLISTS:FUNCTION(){ARRAY.FLATTEN(ARGUMENTS).EACH(FUNCTION(A){THIS.LISTS.PUSH(A);THIS.ADDITEMS(A.GETCHILDREN())},THIS);RETURN THIS},REMOVEITEMS:FUNCTION(){VAR A=[];ARRAY.FLATTEN(ARGUMENTS).EACH(FUNCTION(B){A.PUSH(B);THIS.ELEMENTS.ERASE(B);VAR C=B.RETRIEVE("SORTABLES:START");(THIS.OPTIONS.HANDLE?B.GETELEMENT(THIS.OPTIONS.HANDLE)||B:B).REMOVEEVENT("MOUSEDOWN",C)},
THIS);RETURN $$(A)},REMOVELISTS:FUNCTION(){VAR A=[];ARRAY.FLATTEN(ARGUMENTS).EACH(FUNCTION(B){A.PUSH(B);THIS.LISTS.ERASE(B);THIS.REMOVEITEMS(B.GETCHILDREN())},THIS);RETURN $$(A)},GETCLONE:FUNCTION(A,B){RETURN!THIS.OPTIONS.CLONE?(NEW ELEMENT("DIV")).INJECT(DOCUMENT.BODY):$TYPE(THIS.OPTIONS.CLONE)=="FUNCTION"?THIS.OPTIONS.CLONE.CALL(THIS,A,B,THIS.LIST):B.CLONE(!0).SETSTYLES({MARGIN:"0PX",POSITION:"ABSOLUTE",VISIBILITY:"HIDDEN",WIDTH:B.GETSTYLE("WIDTH")}).INJECT(THIS.LIST).POSITION(B.GETPOSITION(B.GETOFFSETPARENT()))},
GETDROPPABLES:FUNCTION(){VAR A=THIS.LIST.GETCHILDREN();THIS.OPTIONS.CONSTRAIN||(A=THIS.LISTS.CONCAT(A).ERASE(THIS.LIST));RETURN A.ERASE(THIS.CLONE).ERASE(THIS.ELEMENT)},INSERT:FUNCTION(A,B){VAR C="INSIDE";THIS.LISTS.CONTAINS(B)?(THIS.LIST=B,THIS.DRAG.DROPPABLES=THIS.GETDROPPABLES()):C=THIS.ELEMENT.GETALLPREVIOUS().CONTAINS(B)?"BEFORE":"AFTER";THIS.ELEMENT.INJECT(B,C);THIS.FIREEVENT("SORT",[THIS.ELEMENT,THIS.CLONE])},START:FUNCTION(A,B){IF(THIS.IDLE)THIS.IDLE=!1,THIS.ELEMENT=B,THIS.OPACITY=B.GET("OPACITY"),
THIS.LIST=B.GETPARENT(),THIS.CLONE=THIS.GETCLONE(A,B),THIS.DRAG=NEW DRAG.MOVE(THIS.CLONE,{SNAP:THIS.OPTIONS.SNAP,CONTAINER:THIS.OPTIONS.CONSTRAIN&&THIS.ELEMENT.GETPARENT(),DROPPABLES:THIS.GETDROPPABLES(),ONSNAP:FUNCTION(){A.STOP();THIS.CLONE.SETSTYLE("VISIBILITY","VISIBLE");THIS.ELEMENT.SET("OPACITY",THIS.OPTIONS.OPACITY||0);THIS.FIREEVENT("START",[THIS.ELEMENT,THIS.CLONE])}.BIND(THIS),ONENTER:THIS.INSERT.BIND(THIS),ONCANCEL:THIS.RESET.BIND(THIS),ONCOMPLETE:THIS.END.BIND(THIS)}),THIS.CLONE.INJECT(THIS.ELEMENT,
"BEFORE"),THIS.DRAG.START(A)},END:FUNCTION(){THIS.DRAG.DETACH();THIS.ELEMENT.SET("OPACITY",THIS.OPACITY);IF(THIS.EFFECT){VAR A=THIS.ELEMENT.GETSTYLES("WIDTH","HEIGHT"),B=THIS.CLONE.COMPUTEPOSITION(THIS.ELEMENT.GETPOSITION(THIS.CLONE.OFFSETPARENT));THIS.EFFECT.ELEMENT=THIS.CLONE;THIS.EFFECT.START({TOP:B.TOP,LEFT:B.LEFT,WIDTH:A.WIDTH,HEIGHT:A.HEIGHT,OPACITY:0.25}).CHAIN(THIS.RESET.BIND(THIS))}ELSE THIS.RESET()},RESET:FUNCTION(){THIS.IDLE=!0;THIS.CLONE.DESTROY();THIS.FIREEVENT("COMPLETE",THIS.ELEMENT)},
SERIALIZE:FUNCTION(){VAR A=ARRAY.LINK(ARGUMENTS,{MODIFIER:FUNCTION.TYPE,INDEX:$DEFINED}),B=THIS.LISTS.MAP(FUNCTION(B){RETURN B.GETCHILDREN().MAP(A.MODIFIER||FUNCTION(A){RETURN A.GET("ID")},THIS)},THIS),C=A.INDEX;THIS.LISTS.LENGTH==1&&(C=0);RETURN $CHK(C)&&C>=0&&C<THIS.LISTS.LENGTH?B[C]:B}}),TIPS=NEW CLASS({IMPLEMENTS:[EVENTS,OPTIONS],OPTIONS:{ONSHOW:FUNCTION(A){A.SETSTYLE("VISIBILITY","VISIBLE")},ONHIDE:FUNCTION(A){A.SETSTYLE("VISIBILITY","HIDDEN")},SHOWDELAY:100,HIDEDELAY:100,CLASSNAME:NULL,OFFSETS:{X:16,
Y:16},FIXED:!1},INITIALIZE:FUNCTION(){VAR A=ARRAY.LINK(ARGUMENTS,{OPTIONS:OBJECT.TYPE,ELEMENTS:$DEFINED});THIS.SETOPTIONS(A.OPTIONS||NULL);THIS.TIP=(NEW ELEMENT("DIV")).INJECT(DOCUMENT.BODY);THIS.OPTIONS.CLASSNAME&&THIS.TIP.ADDCLASS(THIS.OPTIONS.CLASSNAME);(NEW ELEMENT("DIV",{"CLASS":"TIP-TOP"})).INJECT(THIS.TIP);THIS.CONTAINER=(NEW ELEMENT("DIV",{"CLASS":"TIP"})).INJECT(THIS.TIP);(NEW ELEMENT("DIV",{"CLASS":"TIP-BOTTOM"})).INJECT(THIS.TIP);THIS.TIP.SETSTYLES({POSITION:"ABSOLUTE",TOP:0,LEFT:0,VISIBILITY:"HIDDEN"});
A.ELEMENTS&&THIS.ATTACH(A.ELEMENTS)},ATTACH:FUNCTION(A){$$(A).EACH(FUNCTION(A){A.RETRIEVE("TIP:TITLE",A.GET("TITLE"));A.RETRIEVE("TIP:TEXT",A.GET("REL")||A.GET("HREF"));VAR C=A.RETRIEVE("TIP:ENTER",THIS.ELEMENTENTER.BINDWITHEVENT(THIS,A)),D=A.RETRIEVE("TIP:LEAVE",THIS.ELEMENTLEAVE.BINDWITHEVENT(THIS,A));A.ADDEVENTS({MOUSEENTER:C,MOUSELEAVE:D});THIS.OPTIONS.FIXED||(C=A.RETRIEVE("TIP:MOVE",THIS.ELEMENTMOVE.BINDWITHEVENT(THIS,A)),A.ADDEVENT("MOUSEMOVE",C));A.STORE("TIP:NATIVE",A.GET("TITLE"));A.ERASE("TITLE")},
THIS);RETURN THIS},DETACH:FUNCTION(A){$$(A).EACH(FUNCTION(A){A.REMOVEEVENT("MOUSEENTER",A.RETRIEVE("TIP:ENTER")||$EMPTY);A.REMOVEEVENT("MOUSELEAVE",A.RETRIEVE("TIP:LEAVE")||$EMPTY);A.REMOVEEVENT("MOUSEMOVE",A.RETRIEVE("TIP:MOVE")||$EMPTY);A.ELIMINATE("TIP:ENTER").ELIMINATE("TIP:LEAVE").ELIMINATE("TIP:MOVE");VAR C=A.RETRIEVE("TIP:NATIVE");C&&A.SET("TITLE",C)});RETURN THIS},ELEMENTENTER:FUNCTION(A,B){$A(THIS.CONTAINER.CHILDNODES).EACH(ELEMENT.DISPOSE);VAR C=B.RETRIEVE("TIP:TITLE");IF(C)THIS.TITLEELEMENT=
(NEW ELEMENT("DIV",{"CLASS":"TIP-TITLE"})).INJECT(THIS.CONTAINER),THIS.FILL(THIS.TITLEELEMENT,C);IF(C=B.RETRIEVE("TIP:TEXT"))THIS.TEXTELEMENT=(NEW ELEMENT("DIV",{"CLASS":"TIP-TEXT"})).INJECT(THIS.CONTAINER),THIS.FILL(THIS.TEXTELEMENT,C);THIS.TIMER=$CLEAR(THIS.TIMER);THIS.TIMER=THIS.SHOW.DELAY(THIS.OPTIONS.SHOWDELAY,THIS);THIS.POSITION(!THIS.OPTIONS.FIXED?A:{PAGE:B.GETPOSITION()})},ELEMENTLEAVE:FUNCTION(){$CLEAR(THIS.TIMER);THIS.TIMER=THIS.HIDE.DELAY(THIS.OPTIONS.HIDEDELAY,THIS)},ELEMENTMOVE:FUNCTION(A){THIS.POSITION(A)},
POSITION:FUNCTION(A){VAR B=WINDOW.GETSIZE(),C=WINDOW.GETSCROLL(),D={X:THIS.TIP.OFFSETWIDTH,Y:THIS.TIP.OFFSETHEIGHT},E={X:"LEFT",Y:"TOP"},F;FOR(F IN E){VAR G=A.PAGE[F]+THIS.OPTIONS.OFFSETS[F];G+D[F]-C[F]>B[F]&&(G=A.PAGE[F]-THIS.OPTIONS.OFFSETS[F]-D[F]);THIS.TIP.SETSTYLE(E[F],G)}},FILL:FUNCTION(A,B){TYPEOF B=="STRING"?A.SET("HTML",B):A.ADOPT(B)},SHOW:FUNCTION(){THIS.FIREEVENT("SHOW",THIS.TIP)},HIDE:FUNCTION(){THIS.FIREEVENT("HIDE",THIS.TIP)}}),SMOOTHSCROLL=NEW CLASS({EXTENDS:FX.SCROLL,INITIALIZE:FUNCTION(A,
B){VAR B=B||DOCUMENT,C=B.GETDOCUMENT(),D=B.GETWINDOW();THIS.PARENT(C,A);THIS.LINKS=THIS.OPTIONS.LINKS?$$(THIS.OPTIONS.LINKS):$$(C.LINKS);VAR E=D.LOCATION.HREF.MATCH(/^[^#]*/)[0]+"#";THIS.LINKS.EACH(FUNCTION(A){IF(A.HREF.INDEXOF(E)==0){VAR B=A.HREF.SUBSTR(E.LENGTH);B&&$(B)&&THIS.USELINK(A,B)}},THIS);BROWSER.ENGINE.WEBKIT419||THIS.ADDEVENT("COMPLETE",FUNCTION(){D.LOCATION.HASH=THIS.ANCHOR},!0)},USELINK:FUNCTION(A,B){A.ADDEVENT("CLICK",FUNCTION(A){THIS.ANCHOR=B;THIS.TOELEMENT(B);A.STOP()}.BIND(THIS))}}),
SLIDER=NEW CLASS({IMPLEMENTS:[EVENTS,OPTIONS],OPTIONS:{ONTICK:FUNCTION(A){THIS.OPTIONS.SNAP&&(A=THIS.TOPOSITION(THIS.STEP));THIS.KNOB.SETSTYLE(THIS.PROPERTY,A)},SNAP:!1,OFFSET:0,RANGE:!1,WHEEL:!1,STEPS:100,MODE:"HORIZONTAL"},INITIALIZE:FUNCTION(A,B,C){THIS.SETOPTIONS(C);THIS.ELEMENT=$(A);THIS.KNOB=$(B);THIS.PREVIOUSCHANGE=THIS.PREVIOUSEND=THIS.STEP=-1;THIS.ELEMENT.ADDEVENT("MOUSEDOWN",THIS.CLICKEDELEMENT.BIND(THIS));THIS.OPTIONS.WHEEL&&THIS.ELEMENT.ADDEVENT("MOUSEWHEEL",THIS.SCROLLEDELEMENT.BINDWITHEVENT(THIS));
VAR D,A={},B={X:!1,Y:!1};SWITCH(THIS.OPTIONS.MODE){CASE "VERTICAL":THIS.AXIS="Y";THIS.PROPERTY="TOP";D="OFFSETHEIGHT";BREAK;CASE "HORIZONTAL":THIS.AXIS="X",THIS.PROPERTY="LEFT",D="OFFSETWIDTH"}THIS.HALF=THIS.KNOB[D]/2;THIS.FULL=THIS.ELEMENT[D]-THIS.KNOB[D]+THIS.OPTIONS.OFFSET*2;THIS.MIN=$CHK(THIS.OPTIONS.RANGE[0])?THIS.OPTIONS.RANGE[0]:0;THIS.MAX=$CHK(THIS.OPTIONS.RANGE[1])?THIS.OPTIONS.RANGE[1]:THIS.OPTIONS.STEPS;THIS.RANGE=THIS.MAX-THIS.MIN;THIS.STEPS=THIS.OPTIONS.STEPS||THIS.FULL;THIS.STEPSIZE=
MATH.ABS(THIS.RANGE)/THIS.STEPS;THIS.STEPWIDTH=THIS.STEPSIZE*THIS.FULL/MATH.ABS(THIS.RANGE);THIS.KNOB.SETSTYLE("POSITION","RELATIVE").SETSTYLE(THIS.PROPERTY,-THIS.OPTIONS.OFFSET);B[THIS.AXIS]=THIS.PROPERTY;A[THIS.AXIS]=[-THIS.OPTIONS.OFFSET,THIS.FULL-THIS.OPTIONS.OFFSET];THIS.DRAG=NEW DRAG(THIS.KNOB,{SNAP:0,LIMIT:A,MODIFIERS:B,ONDRAG:THIS.DRAGGEDKNOB.BIND(THIS),ONSTART:THIS.DRAGGEDKNOB.BIND(THIS),ONCOMPLETE:FUNCTION(){THIS.DRAGGEDKNOB();THIS.END()}.BIND(THIS)});IF(THIS.OPTIONS.SNAP)THIS.DRAG.OPTIONS.GRID=
MATH.CEIL(THIS.STEPWIDTH),THIS.DRAG.OPTIONS.LIMIT[THIS.AXIS][1]=THIS.FULL},SET:FUNCTION(A){IF(!(THIS.RANGE>0^A<THIS.MIN))A=THIS.MIN;IF(!(THIS.RANGE>0^A>THIS.MAX))A=THIS.MAX;IF(THIS.STEP==A)RETURN THIS;THIS.STEP=MATH.ROUND(A);THIS.CHECKSTEP();THIS.END();THIS.FIREEVENT("TICK",THIS.TOPOSITION(THIS.STEP));RETURN THIS},CLICKEDELEMENT:FUNCTION(A){VAR B=THIS.RANGE<0?-1:1,A=A.PAGE[THIS.AXIS]-THIS.ELEMENT.GETPOSITION()[THIS.AXIS]-THIS.HALF,A=A.LIMIT(-THIS.OPTIONS.OFFSET,THIS.FULL-THIS.OPTIONS.OFFSET);THIS.STEP=
MATH.ROUND(THIS.MIN+B*THIS.TOSTEP(A));THIS.CHECKSTEP();THIS.END();THIS.FIREEVENT("TICK",A)},SCROLLEDELEMENT:FUNCTION(A){THIS.SET((THIS.OPTIONS.MODE=="HORIZONTAL"?A.WHEEL<0:A.WHEEL>0)?THIS.STEP-THIS.STEPSIZE:THIS.STEP+THIS.STEPSIZE);A.STOP()},DRAGGEDKNOB:FUNCTION(){VAR A=THIS.RANGE<0?-1:1,B=THIS.DRAG.VALUE.NOW[THIS.AXIS],B=B.LIMIT(-THIS.OPTIONS.OFFSET,THIS.FULL-THIS.OPTIONS.OFFSET);THIS.STEP=MATH.ROUND(THIS.MIN+A*THIS.TOSTEP(B));THIS.CHECKSTEP()},CHECKSTEP:FUNCTION(){IF(THIS.PREVIOUSCHANGE!=THIS.STEP)THIS.PREVIOUSCHANGE=
THIS.STEP,THIS.FIREEVENT("CHANGE",THIS.STEP)},END:FUNCTION(){IF(THIS.PREVIOUSEND!==THIS.STEP)THIS.PREVIOUSEND=THIS.STEP,THIS.FIREEVENT("COMPLETE",THIS.STEP+"")},TOSTEP:FUNCTION(A){A=(A+THIS.OPTIONS.OFFSET)*THIS.STEPSIZE/THIS.FULL*THIS.STEPS;RETURN THIS.OPTIONS.STEPS?MATH.ROUND(A-A%THIS.STEPSIZE):A},TOPOSITION:FUNCTION(A){RETURN THIS.FULL*MATH.ABS(THIS.MIN-A)/(THIS.STEPS*THIS.STEPSIZE)-THIS.OPTIONS.OFFSET}}),SCROLLER=NEW CLASS({IMPLEMENTS:[EVENTS,OPTIONS],OPTIONS:{AREA:20,VELOCITY:1,ONCHANGE:FUNCTION(A,
B){THIS.ELEMENT.SCROLLTO(A,B)}},INITIALIZE:FUNCTION(A,B){THIS.SETOPTIONS(B);THIS.ELEMENT=$(A);THIS.LISTENER=$TYPE(THIS.ELEMENT)!="ELEMENT"?$(THIS.ELEMENT.GETDOCUMENT().BODY):THIS.ELEMENT;THIS.TIMER=NULL;THIS.COORD=THIS.GETCOORDS.BIND(THIS)},START:FUNCTION(){THIS.LISTENER.ADDEVENT("MOUSEMOVE",THIS.COORD)},STOP:FUNCTION(){THIS.LISTENER.REMOVEEVENT("MOUSEMOVE",THIS.COORD);THIS.TIMER=$CLEAR(THIS.TIMER)},GETCOORDS:FUNCTION(A){THIS.PAGE=THIS.LISTENER.GET("TAG")=="BODY"?A.CLIENT:A.PAGE;IF(!THIS.TIMER)THIS.TIMER=
THIS.SCROLL.PERIODICAL(50,THIS)},SCROLL:FUNCTION(){VAR A=THIS.ELEMENT.GETSIZE(),B=THIS.ELEMENT.GETSCROLL(),C=THIS.ELEMENT.GETPOSITION(),D={X:0,Y:0},E;FOR(E IN THIS.PAGE)THIS.PAGE[E]<THIS.OPTIONS.AREA+C[E]&&B[E]!=0?D[E]=(THIS.PAGE[E]-THIS.OPTIONS.AREA-C[E])*THIS.OPTIONS.VELOCITY:THIS.PAGE[E]+THIS.OPTIONS.AREA>A[E]+C[E]&&A[E]+A[E]!=B[E]&&(D[E]=(THIS.PAGE[E]-A[E]+THIS.OPTIONS.AREA-C[E])*THIS.OPTIONS.VELOCITY);(D.Y||D.X)&&THIS.FIREEVENT("CHANGE",[B.X+D.X,B.Y+D.Y])}}),ACCORDION=NEW CLASS({EXTENDS:FX.ELEMENTS,
OPTIONS:{DISPLAY:0,SHOW:!1,HEIGHT:!0,WIDTH:!1,OPACITY:!0,FIXEDHEIGHT:!1,FIXEDWIDTH:!1,WAIT:!1,ALWAYSHIDE:!1},INITIALIZE:FUNCTION(){VAR A=ARRAY.LINK(ARGUMENTS,{CONTAINER:ELEMENT.TYPE,OPTIONS:OBJECT.TYPE,TOGGLERS:$DEFINED,ELEMENTS:$DEFINED});THIS.PARENT(A.ELEMENTS,A.OPTIONS);THIS.TOGGLERS=$$(A.TOGGLERS);THIS.CONTAINER=$(A.CONTAINER);THIS.PREVIOUS=-1;IF(THIS.OPTIONS.ALWAYSHIDE)THIS.OPTIONS.WAIT=!0;IF($CHK(THIS.OPTIONS.SHOW))THIS.OPTIONS.DISPLAY=!1,THIS.PREVIOUS=THIS.OPTIONS.SHOW;IF(THIS.OPTIONS.START)THIS.OPTIONS.DISPLAY=
!1,THIS.OPTIONS.SHOW=!1;THIS.EFFECTS={};IF(THIS.OPTIONS.OPACITY)THIS.EFFECTS.OPACITY="FULLOPACITY";IF(THIS.OPTIONS.WIDTH)THIS.EFFECTS.WIDTH=THIS.OPTIONS.FIXEDWIDTH?"FULLWIDTH":"OFFSETWIDTH";IF(THIS.OPTIONS.HEIGHT)THIS.EFFECTS.HEIGHT=THIS.OPTIONS.FIXEDHEIGHT?"FULLHEIGHT":"SCROLLHEIGHT";FOR(VAR A=0,B=THIS.TOGGLERS.LENGTH;A<B;A++)THIS.ADDSECTION(THIS.TOGGLERS[A],THIS.ELEMENTS[A]);THIS.ELEMENTS.EACH(FUNCTION(A,B){IF(THIS.OPTIONS.SHOW===B)THIS.FIREEVENT("ACTIVE",[THIS.TOGGLERS[B],A]);ELSE FOR(VAR E IN THIS.EFFECTS)A.SETSTYLE(E,
0)},THIS);$CHK(THIS.OPTIONS.DISPLAY)&&THIS.DISPLAY(THIS.OPTIONS.DISPLAY)},ADDSECTION:FUNCTION(A,B,C){VAR A=$(A),B=$(B),D=THIS.TOGGLERS.CONTAINS(A),E=THIS.TOGGLERS.LENGTH;THIS.TOGGLERS.INCLUDE(A);THIS.ELEMENTS.INCLUDE(B);E&&(!D||C)?(C=$PICK(C,E-1),A.INJECT(THIS.TOGGLERS[C],"BEFORE"),B.INJECT(A,"AFTER")):THIS.CONTAINER&&!D&&(A.INJECT(THIS.CONTAINER),B.INJECT(THIS.CONTAINER));C=THIS.TOGGLERS.INDEXOF(A);A.ADDEVENT("CLICK",THIS.DISPLAY.BIND(THIS,C));THIS.OPTIONS.HEIGHT&&B.SETSTYLES({"PADDING-TOP":0,"BORDER-TOP":"NONE",
"PADDING-BOTTOM":0,"BORDER-BOTTOM":"NONE"});THIS.OPTIONS.WIDTH&&B.SETSTYLES({"PADDING-LEFT":0,"BORDER-LEFT":"NONE","PADDING-RIGHT":0,"BORDER-RIGHT":"NONE"});B.FULLOPACITY=1;IF(THIS.OPTIONS.FIXEDWIDTH)B.FULLWIDTH=THIS.OPTIONS.FIXEDWIDTH;IF(THIS.OPTIONS.FIXEDHEIGHT)B.FULLHEIGHT=THIS.OPTIONS.FIXEDHEIGHT;B.SETSTYLE("OVERFLOW","HIDDEN");IF(!D)FOR(VAR F IN THIS.EFFECTS)B.SETSTYLE(F,0);RETURN THIS},DISPLAY:FUNCTION(A){A=$TYPE(A)=="ELEMENT"?THIS.ELEMENTS.INDEXOF(A):A;IF(THIS.TIMER&&THIS.OPTIONS.WAIT||A===
THIS.PREVIOUS&&!THIS.OPTIONS.ALWAYSHIDE)RETURN THIS;THIS.PREVIOUS=A;VAR B={};THIS.ELEMENTS.EACH(FUNCTION(C,D){B[D]={};VAR E=D!=A||THIS.OPTIONS.ALWAYSHIDE&&C.OFFSETHEIGHT>0;THIS.FIREEVENT(E?"BACKGROUND":"ACTIVE",[THIS.TOGGLERS[D],C]);FOR(VAR F IN THIS.EFFECTS)B[D][F]=E?0:C[THIS.EFFECTS[F]]},THIS);RETURN THIS.START(B)}});
